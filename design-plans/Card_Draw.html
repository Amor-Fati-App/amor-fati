<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amor Fati - The Ritual</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;0,700;1,400;1,600&family=Montserrat:wght@400;500;600;700&family=Pinyon+Script&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        void: '#050505',
                        surface: '#0f0f0f',
                        gold: '#d4af37',
                        ivory: '#f2e8e3',
                        oxblood: '#1a0505'
                    },
                    fontFamily: {
                        display: ['"Cormorant Garamond"', 'serif'],
                        sans: ['"Montserrat"', 'sans-serif'],
                        script: ['"Pinyon Script"', 'cursive'],
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'shuffle': 'shuffle 0.5s infinite',
                        'deal': 'deal 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'pulse-slow': 'pulse 3s infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        shuffle: {
                            '0%': { transform: 'translateX(0) rotate(0)' },
                            '25%': { transform: 'translateX(-5px) rotate(-2deg)' },
                            '75%': { transform: 'translateX(5px) rotate(2deg)' },
                            '100%': { transform: 'translateX(0) rotate(0)' },
                        },
                        deal: {
                            '0%': { transform: 'translate(0, 50vh) scale(0.5)', opacity: '0' },
                            '100%': { transform: 'translate(0, 0) scale(1)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #050505;
            color: #f2e8e3;
            overflow: hidden;
            cursor: none;
        }

        /* --- CARD STYLING --- */
        .tarot-card {
            width: 100%;
            aspect-ratio: 2/3.5;
            background-image: url('https://www.transparenttextures.com/patterns/stardust.png'), linear-gradient(135deg, #1a0a0a 0%, #050505 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            position: relative;
            transform-style: preserve-3d;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            transition: all 0.3s ease;
        }
        
        .tarot-card::before {
            content: '';
            position: absolute;
            inset: 4px;
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 4px;
        }

        .tarot-card.selected {
            border-color: #d4af37;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.4);
        }

        /* --- DECK FAN STYLING --- */
        .deck-fan {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            height: 120px;
            width: 100%;
            overflow-x: auto;
            padding-bottom: 2rem;
            /* Hide scrollbar */
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .deck-fan::-webkit-scrollbar { display: none; }

        .fan-card {
            width: 60px;
            height: 90px;
            background: #1a0a0a;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 4px;
            margin-right: -30px; /* Overlap */
            transition: transform 0.2s ease, margin 0.2s ease;
            cursor: pointer;
            flex-shrink: 0;
            position: relative;
        }
        .fan-card:hover {
            transform: translateY(-20px) scale(1.1);
            margin-right: 10px;
            z-index: 10;
            border-color: #d4af37;
        }
        
        /* --- SPREAD SLOTS --- */
        .spread-slot {
            width: 100%;
            aspect-ratio: 2/3.5;
            border: 1px dashed rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .spread-slot.active {
            border-color: #d4af37;
            background: rgba(212, 175, 55, 0.05);
        }
        .slot-label {
            position: absolute;
            bottom: -25px;
            width: 100%;
            text-align: center;
            font-family: 'Montserrat', sans-serif;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            color: rgba(255,255,255,0.4);
        }
        .slot-number {
            font-family: 'Cormorant Garamond', serif;
            font-size: 2rem;
            color: rgba(255,255,255,0.05);
            font-weight: 700;
        }

        /* --- ANIMATION STATES --- */
        .shuffling .deck-stack-card {
            animation: shuffle 0.2s infinite;
        }
        
        /* Custom Cursor */
        .cursor-dot {
            width: 6px; height: 6px; background-color: #d4af37;
            position: fixed; top: 0; left: 0; transform: translate(-50%, -50%);
            border-radius: 50%; pointer-events: none; z-index: 9999;
            box-shadow: 0 0 10px #d4af37;
        }
        .cursor-outline {
            width: 40px; height: 40px; border: 1px solid rgba(212, 175, 55, 0.5);
            position: fixed; top: 0; left: 0; transform: translate(-50%, -50%);
            border-radius: 50%; pointer-events: none; z-index: 9999;
            transition: width 0.3s, height 0.3s, background-color 0.3s;
        }
    </style>
</head>
<body class="selection:bg-gold selection:text-black">

    <!-- Cursor -->
    <div class="cursor-dot hidden md:block"></div>
    <div class="cursor-outline hidden md:block"></div>

    <!-- Background -->
    <div class="fixed inset-0 z-0 bg-void">
        <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_center,_#1a1a1a_0%,_transparent_70%)] opacity-40"></div>
        <img src="https://images.unsplash.com/photo-1516339901601-2e1b62dc0c45?q=80&w=2600&auto=format&fit=crop" class="w-full h-full object-cover opacity-5 mix-blend-screen" alt="Noise">
    </div>

    <!-- MAIN INTERFACE -->
    <main class="relative z-10 w-full h-screen flex flex-col items-center justify-between py-8 px-4 max-w-5xl mx-auto">
        
        <!-- Header: Context -->
        <header class="text-center w-full relative">
            <h1 class="font-display text-2xl text-white tracking-widest">AMOR <span class="text-gold">FATI</span></h1>
            <div class="flex items-center justify-center gap-3 mt-2">
                <span class="h-px w-8 bg-white/10"></span>
                <p id="instruction-text" class="font-sans text-[10px] uppercase tracking-[0.3em] text-gold animate-pulse">Touch deck to shuffle</p>
                <span class="h-px w-8 bg-white/10"></span>
            </div>
            
            <!-- Progress / Spread Info -->
            <div class="absolute right-0 top-0 hidden md:block text-right">
                <span class="block font-display text-lg text-white">Three Card Spread</span>
                <span class="block font-sans text-[10px] text-white/40 uppercase tracking-widest">Past / Present / Future</span>
            </div>
        </header>

        <!-- CENTER STAGE: THE SPREAD -->
        <div id="spread-stage" class="flex-1 w-full flex items-center justify-center opacity-30 transition-opacity duration-1000">
            <div class="grid grid-cols-3 gap-4 md:gap-12 w-full max-w-3xl px-4">
                
                <!-- SLOT 1 -->
                <div class="spread-slot active" id="slot-1">
                    <span class="slot-number">I</span>
                    <div class="slot-label">The Past</div>
                </div>

                <!-- SLOT 2 -->
                <div class="spread-slot" id="slot-2">
                    <span class="slot-number">II</span>
                    <div class="slot-label">The Present</div>
                </div>

                <!-- SLOT 3 -->
                <div class="spread-slot" id="slot-3">
                    <span class="slot-number">III</span>
                    <div class="slot-label">The Future</div>
                </div>

            </div>
        </div>

        <!-- LOWER STAGE: THE DECK & CONTROLS -->
        <div class="w-full h-1/3 flex flex-col items-center justify-end relative">
            
            <!-- PHASE 1: SHUFFLE STACK -->
            <div id="shuffle-container" class="absolute bottom-20 cursor-pointer group" onmousedown="startShuffle()" onmouseup="stopShuffle()" ontouchstart="startShuffle()" ontouchend="stopShuffle()">
                <div class="relative w-32 h-48 md:w-40 md:h-60">
                    <!-- Layered Cards Effect -->
                    <div class="deck-stack-card absolute inset-0 bg-[#2a1a1a] rounded-lg border border-white/10 transform translate-x-1 translate-y-1"></div>
                    <div class="deck-stack-card absolute inset-0 bg-[#201010] rounded-lg border border-white/10 transform -translate-x-1 -translate-y-1"></div>
                    <!-- Main Top Card -->
                    <div id="main-deck-card" class="deck-stack-card absolute inset-0 bg-oxblood rounded-lg border border-gold/30 flex items-center justify-center shadow-2xl transition-transform group-hover:scale-105">
                        <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] opacity-20"></div>
                        <i class="ph-thin ph-infinity text-6xl text-gold opacity-50"></i>
                    </div>
                    
                    <!-- Energy Glow -->
                    <div id="shuffle-glow" class="absolute inset-0 bg-gold rounded-lg blur-xl opacity-0 transition-opacity duration-300"></div>
                </div>
            </div>

            <!-- PHASE 2: CARD SELECTION FAN (Hidden Initially) -->
            <div id="selection-fan" class="deck-fan opacity-0 pointer-events-none transition-all duration-1000 translate-y-20">
                <!-- Cards injected via JS -->
            </div>

        </div>

        <!-- FOOTER: ACTIONS -->
        <div class="w-full flex justify-between items-center py-4 border-t border-white/5 mt-4">
            <button class="text-xs font-sans uppercase tracking-widest text-white/30 hover:text-white transition-colors">Reset</button>
            <div class="flex gap-2">
                <span id="counter" class="text-xs font-display text-white italic">0</span>
                <span class="text-xs font-sans text-white/30">/ 3 Selected</span>
            </div>
            <button id="btn-reveal" class="opacity-0 px-6 py-2 bg-gold text-black font-sans text-xs font-bold uppercase tracking-widest rounded-sm hover:bg-white transition-all cursor-not-allowed" disabled>
                Reveal Spread
            </button>
        </div>

    </main>

    <script>
        // --- CONFIG ---
        const totalCardsInDeck = 22; // Major Arcana count for visual fan
        const spreadSize = 3;
        
        // --- DOM ELEMENTS ---
        const shuffleContainer = document.getElementById('shuffle-container');
        const shuffleGlow = document.getElementById('shuffle-glow');
        const deckCard = document.getElementById('main-deck-card');
        const spreadStage = document.getElementById('spread-stage');
        const selectionFan = document.getElementById('selection-fan');
        const instruction = document.getElementById('instruction-text');
        const counterEl = document.getElementById('counter');
        const revealBtn = document.getElementById('btn-reveal');
        
        let selectedCount = 0;
        let shuffleTimer;
        let isShuffling = false;

        // --- SHUFFLE LOGIC ---
        function startShuffle() {
            isShuffling = true;
            shuffleContainer.classList.add('shuffling');
            shuffleGlow.style.opacity = '0.4';
            instruction.innerText = "Channeling Energy...";
            instruction.classList.remove('animate-pulse');
            
            // Haptic/Visual Feedback
            deckCard.style.borderColor = '#d4af37';
        }

        function stopShuffle() {
            if(!isShuffling) return;
            isShuffling = false;
            shuffleContainer.classList.remove('shuffling');
            shuffleGlow.style.opacity = '0';
            
            // Transition to Phase 2
            proceedToDeal();
        }

        function proceedToDeal() {
            instruction.innerText = "Select 3 cards";
            instruction.classList.add('animate-pulse');
            
            // Hide Shuffle Stack
            shuffleContainer.style.transition = "transform 0.6s ease, opacity 0.6s ease";
            shuffleContainer.style.transform = "translateY(200px) scale(0.5)";
            shuffleContainer.style.opacity = "0";
            shuffleContainer.style.pointerEvents = "none";

            // Light up spread
            spreadStage.style.opacity = "1";

            // Show Selection Fan
            selectionFan.classList.remove('opacity-0', 'pointer-events-none', 'translate-y-20');
            
            // Generate Fan
            generateFan();
        }

        // --- DEAL LOGIC ---
        function generateFan() {
            selectionFan.innerHTML = '';
            for(let i=0; i<totalCardsInDeck; i++) {
                const card = document.createElement('div');
                card.className = 'fan-card';
                // Add random slight rotation for realism
                const rot = Math.random() * 4 - 2;
                card.style.transform = `rotate(${rot}deg)`;
                
                card.onclick = (e) => selectCard(e.target);
                selectionFan.appendChild(card);
            }
        }

        function selectCard(cardElement) {
            if(selectedCount >= spreadSize) return;

            // 1. Visually remove from fan
            cardElement.style.opacity = '0';
            cardElement.style.transform = 'translateY(50px)';
            cardElement.style.pointerEvents = 'none';

            // 2. Identify Target Slot
            selectedCount++;
            const targetSlot = document.getElementById(`slot-${selectedCount}`);
            
            // 3. Create a flying card element for animation
            const flyer = document.createElement('div');
            flyer.className = 'tarot-card';
            flyer.classList.add('animate-deal');
            
            // Remove the empty slot styling logic for a moment to place card
            targetSlot.appendChild(flyer);
            
            // Update UI
            counterEl.innerText = selectedCount;
            
            // Highlight next slot
            targetSlot.classList.remove('active');
            if(selectedCount < spreadSize) {
                document.getElementById(`slot-${selectedCount+1}`).classList.add('active');
            }

            // Check completion
            if(selectedCount === spreadSize) {
                instruction.innerText = "Ritual Complete";
                instruction.classList.remove('animate-pulse');
                revealBtn.style.opacity = '1';
                revealBtn.style.cursor = 'pointer';
                revealBtn.disabled = false;
                selectionFan.style.opacity = '0.3';
                selectionFan.style.pointerEvents = 'none';
            }
        }
        
        // Custom Cursor Logic
        const cursorDot = document.querySelector('.cursor-dot');
        const cursorOutline = document.querySelector('.cursor-outline');

        window.addEventListener('mousemove', (e) => {
            cursorDot.style.left = `${e.clientX}px`;
            cursorDot.style.top = `${e.clientY}px`;
            
            cursorOutline.animate({
                left: `${e.clientX}px`,
                top: `${e.clientY}px`
            }, { duration: 500, fill: "forwards" });
        });

        document.querySelectorAll('button, .fan-card, #shuffle-container').forEach(el => {
            el.addEventListener('mouseenter', () => {
                cursorOutline.style.transform = 'translate(-50%, -50%) scale(1.5)';
                cursorOutline.style.backgroundColor = 'rgba(212, 175, 55, 0.1)';
            });
            el.addEventListener('mouseleave', () => {
                cursorOutline.style.transform = 'translate(-50%, -50%) scale(1)';
                cursorOutline.style.backgroundColor = 'transparent';
            });
        });

    </script>
</body>
</html>